var entries=
[
	{
		magazine:"II Computing",
		volume:"1",
		number:"1",
		issue:"1",
		month:"October/November",
		year:"1985",
		url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere",
		tableOfContents:
	   [
		  {title:"Track Halley's Comet", author:{first:"Donald",last:"Tattersfield"}, page:{first:"16"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n16", annotation:"Astronomy" },
		  {title:"Spreadsheet Horrors", author:{first:"Robert",last:"Freeman"}, page:{first:"32"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n33", annotation:"Spreadsheets, business, productivity" },
		  {title:"Profile: Christopher Cerf, Creative Catalyst", author:{first:"Michael", last:"Ciraolo"}, page:{first:"11"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n12"},
		  {title:"Ecto Blasters", author:{first:"Stephan",last:"Schwirzke"}, page:{first:"23"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n24",annotation:"Game" },
		  {title:"Power Programming: Text Handling in Hi-Res", author:{first:"William V.R.",last:"Smith"}, page:{first:"30"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n31"},
		  {title:"College Credit On Line", author:{first:"Paul",last:"Cohen"}, page:{first:"36"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n37", subject:"Education/College" },
		  {title:"Pro Football Prognosticator", author:{first:"William",last:"Marquardt"}, page:{first:"40"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n42", subject:"Sports" },
		  {title:"Reviews", page:{first:"43"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n46", annotation:"Kermit's Electronic StoryMaker; The Speller; Newsroom & Print Shop; Visible Pascal", subject:"Review" },
		  {title:"Sneak Preview: Hardware",page:{first:"44"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n44", annotation:"Z-RAM from Applied Engineering", subject:"Hardware/RAM" },
		  {title:"Sneak Preview: Software",page:{first:"45"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n45"},
		  {title:"For Kids: Ladybug Color Drawing Program", author:{first:"Steven",last:"Koepke"}, page:{first:"53"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n54", subject:"Kids/Graphics" },
		  {title:"Graphics: Color Weaver", author:{first:"Gerald", last:"Hagopian"}, page:{first:"79"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n79", subject:"Graphics/Lo-Res" },
		  {title:"For the Fun of It", author:{first:"Neil",last:"Shapiro"}, page:{first:"24"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n24", annotation:"Games & Entertament Software", subject:"Review" },
		  {title:"Tales From The Crypt", author:{first:"Caxton C. ",last:"Foster"}, page:{first:"27"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n27", annotation:"Cracking Ciphers with Computers", Subject:"Encryption" },
		  {title:"Sotto Voce", author:{first:"Margot",last:"Comstock"}, page:{first:"39"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n40", annotation:"Reflections by a Former Softalk Editor"},
		  {title:"Type-In Listings", author:"", page:{first:"58"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n58", Subject:"Type-In" },
		  {title:"Editorial", page:{first:"6"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n6", annotation:"Brave New Words" },
		  {title:"Perspectives", author:{first:"DeWitt", last:"Robbeloth"}, page:{first:"8"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n8"},
		  {title:"Top Software Charts", page:{first:"51"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n52" },
		  {title:"Typo II", page:{first:"52"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n53",annotation:"typing Checker" },
		  {title:"New Products",page:{first:"82"}, url:"https://archive.org/details/II_Computing_Vol_1_No_1_Oct_Nov_85_Premiere/page/n82" },
		  {titlle:"Computer Frontiers", author:{first:"James",last:"Capparell"}, page:{first:"15"}, url:"",annotation:"Cutting Edge of Computer Technology"}
		]
	},
	{
		magazine:"II Computing",
		volume:"1",
		number:"6",
		month:"August/September",
		year:"1986",
		url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86",
		tableOfContents:
		[
			{title:"An Electronic Orrery", author:{first:"Donald",last:"Tattersfield"}, page:{first:"16"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n16", annotation:"Watch the solar system spin.", subject:"Type-In" },
			{title:"Apple II and the LaserWriter", author:{first:"Scott",last:"Anthony"}, page:{first:"19"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n19", annotation:"A combination that works!", subject:"Printer/Hardware" },
			{title:"Del Yocam", author:{first:"Anita, & Ciraolo, Michael",last:"Malnig"}, page:{first:"24"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n24", annotation:"", subject:"Del Yocam/Interview" },
			{title:"New Vistas for Disabled", author:{first:"Neil S.",last:"Rosenfeld"}, page:{first:"30"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n30", annotation:"Computers lead the way.", subject:"Disability" },
			{title:"What Should Parents Know?", author:{first:"Bobby",last:"Goodson"}, page:{first:"52"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n55", annotation:"The home-school connection.", subject:"Education" },
			{title:"Sotto Voce", author:{first:"Margot",last:"Comstock"}, page:{first:"9",last:""}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n9", annotation:"Reflections by a former Softtalk editor." },
			{title:"Advanced Computer Concepts", author:{first:"Daniel",last:"Wolf"}, page:{first:"63"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n66", annotation:"Thinking about thinking, part 1.", subject:"Expert Systems" },
			{title:"For the Fun of It", author:{first:"Neil",last:"Shapiro"}, page:{first:"76"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n79", annotation:"Games and entertainment software.", subject:"Review" },
			{title:"Software Library",  page:{first:"35",last:"49"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n38", annotation:"Program listings.", subject:"Type-In" },
			{title:"Editorial", author:{first:"Anita",last:"Malnig"}, page:{first:"6"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n6", annotation:"The apple II: catalyst and equalizer.", subject:"Editorial" },
			{title:"Reader Forum",  page:{first:"7"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n7", annotation:"Into the light. Shuttle stripper. Ace in the hole.", subject:"letters" },
			{title:"Advertisers' List",page:{first:"80"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n83", subject:"Advertisers" },
			{title:"New Products", page:{first:"81"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n81", subject:"New Products" },
			{title:"Computer Science on Campus", author:{first:"George, & Johnson, Michael",last:"Beekman"}, page:{first:"11"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n11",  subject:"Education" },
			{title:"Reviews", page:{first:"56"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n59", annotation:"Touch Window; Laser 128; Jeeves, Fingertips and Pinpoint; Sensible Grammar ", subject:"Review" },
			{title:"Castle Game", author:{first:"Tracy and Lori",last:"Hershey"}, page:{first:"68"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n71", subject:"Game/Type-In" },
			{title:"Circle and Polygon Maker", author:{first:"Jenny",last:"Schmidt"}, page:{first:"70"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n73",  subject:"Hi-Res/Graphics/Type-In" },
			{title:"ClockWorks and Clockless Date-Stamping", author:{first:"William V.R., & Rick Robey",last:"Smith"}, page:{first:"72"}, url:"https://archive.org/details/II_Computing_Vol_1_No_6_Aug_Sep_86/page/n75", subject:"ProDOS/Utility/Type-In" }
		]
	},
	{
		magazine:"Nibble",
		volume:"13",
		number:"2",
		month:"February",
		year:"1992",
		url:"",
		tableOfContents:
		[
			{title:"Print Master", author:{first:"Charles T. ",last:"Hill"}, page:{first:"7"},  annotation:"Format program listings for printing.", subject:"Utility/Type-In" },
			{title:"Chicken Little", author:{first:"Jenny",last:"Schmidt"}, page:{first:"14"},annotation:"Cushion the fall of the purple Feathered Wing Flapper's eggs.", subject:"Game/Hi-Res/Type-In" },
			{title:"Speed Search", author:{first:"C. B.",last:"Winkler"}, page:{first:"24"},annotation:"Sift through large arrays to find strings.", subject:"Utility/Type-In" },
			{title:"Viewpoint", subject:"Editorial",page:{first:"2"}, },
			{title:"Ask Nibble", author:{first:"Roger",last:"Wagner"}, page:{first:"4"}, annotation:"Expert answers the tough questions posed by readers.", subject:"Help" },
			{title:"One- and Two-Liners", author:{first:"Rudy",last:"Guy"}, page:{first:"5"},annotation:"Nibbles's shortest programs", subject:"Type-In/Short" },
			{title:"Letters", page:{first:"6"}, subject:"Letters" },
			{title:"Products & Services Index", page:{first:"22"}, subject:"Advertising" },
			{title:"Software Directory", page:{first:"28"}, subject:"Software Directory" }
			
		]
	}
]	

copy(function(entries)
{
	var index={citation:[],magazine:{},author:{},article:{},subject:{}}
	var locator=index.citation.length
	entries.forEach((entry)=>
	{
		
		entry.tableOfContents.forEach((article)=>
		{
			var citation=
			{
				magazine:entry.magazine,
				volume:entry.volume,
				number:entry.number,
				year:entry.year,
				month:entry.month,
				magazineURL:entry.url,
				title:article.title,
				articleURL:article.url,
				annotation:article.annotation
			}
			if (article.author){citation.author={first:article.author.first,last:article.author.last}}
			if (article.page){citation.page={first:Number(article.page.first),last:Number(article.page.last)}}
			if (article.subject)
			{
				citation.subject=article.subject.split("/").map(sub=>
				{ 
					var normalizedSubject=sub.trim().toLowerCase()
					return normalizedSubject[0].toUpperCase() +normalizedSubject.slice(1)
				})
			}
				
			var issue=(citation.volume ? ", " +citation.volume :"")
			+(citation.number ? ", no. " +citation.number:"")
			+(citation.month ? " (" +citation.month : "")
			+(citation.year ? " "+citation.year : "")
			+(citation.month ? ")": "")	
			var magazineKey=(citation.magazine||"")+issue
			var pages=(citation.page.first ? ": "+citation.page.first :"")
				+(citation.page.last ? "-"+citation.page.last :"")
				
			var articleKey=(citation.title||"No Title")
			if (citation.author)
			{
				var authorKey=(citation.author.last||"")+", "+(citation.author.first||"")
			}
			else
			{
				var authorKey="No Author"
			}	
			var subjectKeys=(citation.subject||["No Subject"])

			if (!index.magazine.hasOwnProperty(magazineKey))
			{
				index.magazine[magazineKey]={}
				index.magazine[magazineKey].citationIndex=[]
			}
			index.magazine[magazineKey].citationIndex.push(locator)

			if (!index.article.hasOwnProperty(articleKey))
			{
				index.article[articleKey]={}
				index.article[articleKey].citationIndex=[]
			}
			index.article[articleKey].citationIndex.push(locator)

			subjectKeys.forEach(key=>
			{
				if (!index.subject.hasOwnProperty(key))
				{
					index.subject[key]={}
					index.subject[key].citationIndex=[]
				}
			index.subject[key].citationIndex.push(locator)
			})

			if (!index.author.hasOwnProperty(authorKey))
			{
				index.author[authorKey]={}
				index.author[authorKey].citationIndex=[]
			}
			index.author[authorKey].citationIndex.push(locator)

			citation.body=(authorKey ? authorKey+", ":"")+("<q>"+articleKey+",</q> "+"<em>"+(citation.magazine||"")+"</em>")+issue+pages+"."
			


			citation.body=`<p>${citation.body}<br><span class="small">${citation.annotation||""}</span></p>`
			var url=citation.articleURL||citation.magazineURL
			if (url)
			{
				citation.body=`<a target='_blank' class='text-decoration-none' href='${url}'>${citation.body}</a>`
			}
			citation.body=`${citation.body}<hr>`
			
			locator=index.citation.push(citation)
		
		})
	})

	return index
}(entries))
